<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="renderer" content="webkit|ie-comp|ie-stand"/>
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8,chrome=1"/>
		<#include "../head.html">
		<link href="${res}/ueditor/themes/default/css/ueditor.min.css" rel="stylesheet"/>
		<script src="${res}/js/jquery/jquery.date_input.pack.js"></script>
		<script type="text/javascript" src="${res}/ueditor/ueditor.config.js"></script>
		<script type="text/javascript" src="${res}/ueditor/ueditor.all.min.js"></script>
		<script type="text/javascript">
		var titleAD =$(".r").text();
		if(titleAD.indexOf("HI，tzpt1707 | 退出") != -1)
		{
			$(".yun").remove();
			select2.reset();
		}
	$.ajaxSetup({
		async:true
	});
	$(function(){
		$('#form').lineFeedValidate();
		var ue = UE.getEditor('content');
	});
</script>
<style>
	.edui-default{float:left;}
</style>
	</head>
	<body>
		<div class="form">		
			<form class="form-horizontal" id="form" action="${res}/activity/updateinfo.do?id=${newsInfo.id}" enctype="multipart/form-data" method="post" autocomplete="off">	
			<input id="status" name="status" type="hidden"/>
			<div class="l item item2" style="z-index: 10000;">
				<span class="t l">类别 </span>
				<select class="l select1" width="232"  name="type">
					<option value="${newsInfo.type}"> ${newsInfo.type}</option>
				</select>
				<script type="text/javascript">
				var optext = $('#test0').val();
				if(optext == $("#test1").val())
				{$("#test1").remove();}
				if(optext == $("#test2").val())
				{$("#test2").remove();}
				if(optext == $("#test3").val())
				{$("#test3").remove();}
				</script>
				<div class="clear"></div>
			</div>
			<div class="l item item2" style="z-index: 10000;">
				<span class="t l" style="width:81px;">来源 </span>
				<select class="l select2" width="232"  name="source">
					<option value="${newsInfo.source}" >${newsInfo.source}</option>
				</select>
				<div class="clear"></div>
			</div>
			
			<div class="clear"></div>
			<div class="l item item2">
				<span class="t l">标题 </span>
				<input type="text" class="text l w230" value="${newsInfo.title}" style="width:550px"  name="title"/>
				<div class="clear"></div>
			</div>	
					
			<div class="l item" style="z-index:12; position: static;">
				<span class="t l">时间 </span>
				<input type="text" class="text l date_input startIn" isbottom="1" style="padding-right:10px;width:129px;width:124px\9" value="${(newsInfo.startDate?string('yyyy-MM-dd'))!''}" style="width:139px;width:134px\9" readonly="readonly"/>
				<img src="${res}/images/yun_back_img9.png" class="l date"/>
				<span class="l">&nbsp;</span>
				<select class="time1" width="58">
					<option value="00">00</option><option value="01">01</option>
					<option value="02">02</option><option value="03">03</option>
					<option value="04">04</option><option value="05">05</option>
					<option value="06">06</option><option value="07">07</option>
					<option value="08">08</option><option value="09">09</option>
					<option value="10">10</option><option value="11">11</option>
					<option value="12">12</option><option value="13">13</option>
					<option value="14">14</option><option value="15">15</option>
					<option value="16">16</option><option value="17">17</option>
					<option value="18">18</option><option value="19">19</option>
					<option value="20">20</option><option value="21">21</option>
					<option value="22">22</option><option value="23">23</option>
										
				</select>
				<span class="l" style="margin:0 3px">:</span>
				<select class="time2" width="58">
					<option value="00">00</option>
					<option value="05">05</option>
					<option value="10">10</option>
					<option value="15">15</option>
					<option value="20">20</option>
					<option value="25">25</option>
					<option value="30">30</option>
					<option value="35">35</option>
					<option value="40">40</option>
					<option value="45">45</option>
					<option value="50">50</option>
					<option value="55">55</option>				
				</select>
				<span class="l" style="margin:0 2px">-</span>
				<input type="text" class="text l date_input endIn" isbottom="1" style="padding-right:10px;width:129px;width:124px\9" value="${(newsInfo.endDate?string('yyyy-MM-dd'))!''}" style="width:139px;width:134px\9" readonly="readonly"/>
				<img src="${res}/images/yun_back_img9.png" class="l date"/>
				<span class="l">&nbsp;</span>
				<select class="time3" width="58">
					<option value="00">00</option><option value="01">01</option>
					<option value="02">02</option><option value="03">03</option>
					<option value="04">04</option><option value="05">05</option>
					<option value="06">06</option><option value="07">07</option>
					<option value="08">08</option><option value="09">09</option>
					<option value="10">10</option><option value="11">11</option>
					<option value="12">12</option><option value="13">13</option>
					<option value="14">14</option><option value="15">15</option>
					<option value="16">16</option><option value="17">17</option>
					<option value="18">18</option><option value="19">19</option>
					<option value="20">20</option><option value="21">21</option>
					<option value="22">22</option><option value="23">23</option>					
				</select>
				<span class="l" style="margin:0 2px">:</span>
				<select class="time4" width="58">
					<option value="00">00</option>
					<option value="05">05</option>
					<option value="10">10</option>
					<option value="15">15</option>
					<option value="20">20</option>
					<option value="25">25</option>
					<option value="30">30</option>
					<option value="35">35</option>
					<option value="40">40</option>
					<option value="45">45</option>
					<option value="50">50</option>
					<option value="55">55</option>				
				</select>
			</div>
			<div class="clear"></div>
			
			
			<div class="l item item2">
				<span class="t l">地点 </span>
				<input type="text" class="text l aA" value="${newsInfo.activeAddress}" name="activeAddress" style="width:550px"/>
				<div class="clear"></div>
			</div>
			<div class="clear"></div>
			
			<div class="l item item2" style="width:800px; height: auto;">
				<span class="t l">缩略图 </span>
					<img src="https://img.ytsg.cn/images/newsImages/${newsInfo.image!''}"  id="tmpimg" class="l" width="123" height="80"/>
					<div id="localImag" class="l" style="margin-right:5px"></div>
					<div class="l" style="position:relative; top:47px;left:5px">
						<img class="l" src="${res}/images/yun_back_img9.gif"  id="upimgbtn"/>
						<input type="file" class="upfile" id="upfile" onchange="setImagePreview(123,80)"  name="images"/>
					</div>
					<div class="clear"></div>
			</div>
			<div class="clear"></div>
			
			<div class="l item item2" style="height: auto;">
				<span class="t l">内容 </span>
				<textarea  rows="" cols="" id="content" name="content" index="2" style="width:800px;height:376px;">${newsInfo.content}</textarea>
				<div class="clear"></div>
			</div>
			
			<!-- <div class="l item item2" style="height: auto;">
				<span class="t l">内容 </span>
				<textarea  rows="" cols="" id="content" name="content" index="2" style="width:800px;height:376px;">${newsInfo.content}</textarea>
				<div class="clear"></div>
			</div> -->
			<div class="clear"></div>
			<div class="l item">
				<span class="t l">&nbsp;</span>
				<input type="button" class="btn" onclick="sub(1)" value="确定更改"/>
				<input type="button" class="btn" onclick="sub(5)" value="保存草稿"/>
				<span class="tswords ig1" style="display:none;">您还没有输入内容！</span>
				<#if (status!"0")=="1" || (status!"0")=="5">
					<#if action =="1">
						<span class="r sumbit-msg" style="margin-right:10px;">修改成功!</span>
					<#elseif action =="5">
						<span class="r sumbit-msg" style="margin-right:10px;">保存成功!</span>
					</#if>
					<script type="text/javascript">
						$(".btn").focus();
					</script>
				</#if>
				<#if (status!"0")=="6" || (status!"0")=="10">
					<#if action =="6">
						<span class="r sumbit-msg" style="margin-right:10px;">修改成功!</span>
					<#elseif action =="10">
						<span class="r sumbit-msg" style="margin-right:10px;">保存成功!</span>
					</#if>
					<script type="text/javascript">
						$(".btn").focus();
					</script>
				</#if>
				<div class="clear"></div>
			</div>
			<div class="clear"></div>
			<input type="text" name="start" id="start" style="display:none;">
			<input type="text" name="end" id="end" style="display:none;">
			</form>
		</div>		
	</body>
</html>
<script>	
	
	function setImagePreview(w,h){       
		
		var path=$('#upfile').val();
		var type=path.substr(path.length-3,path.length);
		
		if(type=="jpg" || type=="gif" || type=="png"){
			$('.ig').html('');
		}else{
			$('.ig').html('文件格式不正确!');
			return false;
		}
		
        var docObj = document.getElementById("upfile");//input
		var imgObjPreview = document.getElementById("tmpimg");//img
        var divs = document.getElementById("localImag");//div
        
       // document.getElementById('upimgbtn').style.marginTop=47+'px';
      //  document.getElementById('upfile').style.top=47+'px';
        
        if (docObj.files && docObj.files[0]){
            //火狐下，直接设img属性
            imgObjPreview.style.display = 'block';
            imgObjPreview.style.width = w+"px";
            imgObjPreview.style.height = h+"px";
            imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);
        }else{        	
            //IE下，使用滤镜
            docObj.select();
            var imgSrc = '';
            if (window.getSelection) {//IE11+ 或者标准浏览器
            	window.parent.document.body.focus();
            	imgSrc = window.getSelection().toString();
            }
            else if (document.selection) {//IE10-
            	window.parent.document.body.focus();
            	imgSrc = document.selection.createRange().text;
            }
            var localImagId = document.getElementById("localImag");
            
            //必须设置初始大小
            localImagId.style.width = w+"px";
            localImagId.style.height = h+"px";
            localImagId.style.display = "block";
            
            //图片异常的捕捉，防止用户修改后缀来伪造图片
            try {
                localImagId.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
            } catch(e) {
                alert("您上传的图片格式不正确，请重新选择!");
                return false;
            }
            imgObjPreview.style.display = 'none';
            document.selection.empty();           
        }
        return true;
    }
</script>
<script type="text/javascript">
var timeStart1;
var timeStart2;
var timeEnd1;
var timeEnd2;
<#if newsInfo.startDate??>
	timeStart1 = ${(newsInfo.startDate?string('HH'))!''};
	timeStart2 = ${(newsInfo.startDate?string('mm'))!''};
</#if>
<#if newsInfo.endDate??>
	timeEnd1 = ${(newsInfo.endDate?string('HH'))!''};
	timeEnd2 = ${(newsInfo.endDate?string('mm'))!''};
</#if>




function chooseSelect(id,val){
	$(id).each(function(){
		$(this).children("option").each(function(){
			if($(this).text() == val)
			{				
				this.selected="selected";
			}
		});
	});
}
chooseSelect(".time1",timeStart1);
chooseSelect(".time2",timeStart2);
chooseSelect(".time3",timeEnd1);
chooseSelect(".time4",timeEnd2);

//自定义下拉列表
setSelect('.select1');
setSelect('.time1');
setSelect('.time2');
setSelect('.time3');
setSelect('.time4');
var select2=setSelect('.select2');

function sub(n){
	var text1 = $(".select1").children('option:selected').val()=="请选择馆别"?false:true;
	var text2 = $(".select2").children('option:selected').val()=="请选择馆别"?false:true;
	var ti = $(".w230").val();
	var tia = $(".aA").val();
	var co = $("#content").val();
	var si = $(".startIn").val();
	var ei = $(".endIn").val();
	var up = $("#upfile").val();
	if(ti.length == 0 || ti=="")//tipMsg="请输入您要搜索活动的标题"
	{console.log("ti"); $(".w230").val("请您输入活动的标题").css({color:"#c2c2c2"});return;}
	if(tia ==""||tia.length == 0)
	{console.log("tia"); $(".aA").val("请您输入位置").css({color:"#c2c2c2"});return;}
	if(co.length==0)
	{$(".ig1").css("display","").html("您还没有输入内容");return;}
	var dt1 = $(".startIn").val()+" "+$(".time1").val()+":"+$(".time2").val();
	var dt2 = $(".endIn").val()+" "+$(".time3").val()+":"+$(".time4").val();
	var d1 = new Date(dt1);
	var d2 = new Date(dt2);
	if(d1>d2  || d1 == d2)
	{
		$(".ig1").css("display","").html("您选择的日期有误");return;
	}
	if(d1<d2&&co.length!=0)
	{
		$(".ig2").css("display","none");
	}
	//if(text1&&text2&&ti!=''&&tia!=''&&co!=''&&ti!='请输入您要搜索活动的标题'&&tia!='请您输入位置'&&d1<d2&&up!="文件格式不正确!"){
		$("#start").val(dt1);
		$("#end").val(dt2);
		$("#status").val(n);
		$("#form").submit();
	//}
}

$('.select1').change(function(){
	//获取selected的值 
	var text = $(this).children('option:selected').val();
	//得到对应的    子选项
	if(text != "请选择馆别")
	{
		$.post("${res}/news/news/getMore.do", { content:text },function(data){
			var arr = data.split(",");
			var str = "";
			for(var i=0;i<arr.length;i++){
				str += "<option value='"+arr[i]+"'>"+arr[i]+"</option>";
			}
			jQuery(".select2").find("option").remove();
			jQuery(".select2").append(str);
			select2.reset();
		});
	}
});
$(function(){
	$('.date_input').date_input();
	//点击选择日期按钮，调用日期控件
	$('img.date').click(function(event){
		event.stopPropagation();
		$(this).prev().prev().focus();
	});
})
$(".w230").on("focus",function(){
	if($(this).val() === "请您输入活动的标题")
	{
		$(this).val("");
	}
	$(this).css({color:"#000"});
});
$(".aA").on("focus",function(){
	if($(this).val() == "请您输入位置")
	{
		$(this).val("");
	}
	$(this).css({color:"#000"});
});
</script>